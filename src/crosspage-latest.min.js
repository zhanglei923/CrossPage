/* 
 * CrossPage 0.4
 * https://github.com/zhanglei923/CrossPage/
 * Date: 2013-09-25 
 * 
 * Copyright (c) 2013 ZhangLei
 * 
 * Author: ZhangLei
 * Homepage: https://github.com/zhanglei923 
 * Email: zhang.lei.923@gmail.com 
 * 
 * Under the term of the MIT License
 * http://www.opensource.org/licenses/mit-license.php
*/!function($){var NAMESPACE="crosspage",KEY=""+Math.random(),me=$[NAMESPACE]={},getDepth=function(){if(isTop())return 0;for(var a=1,b=parent;top.location!=b.location;)b=b.parent,a++;return a},getWinOld=function(a,b){var c=getContainerWin(a);if("undefined"==typeof b||!b)return c;if(c&&c.jQuery[NAMESPACE]){var d=c.jQuery[NAMESPACE].getChildWin(b);return d}},getKey=function(){return KEY},getFrameByKey=function(a){var b;return foreachFrame(function(c){var d=c.contentWindow.jQuery;d&&d[NAMESPACE].getKey()==a&&(b=c)}),b},getFrameByWin=function(a){try{if(a&&a.parent&&a.parent.jQuery){var b=a.parent.jQuery[NAMESPACE].getFrameByKey(a.jQuery[NAMESPACE].getKey());return b}}catch(c){throw new Error("getFrameByWin(): cross domain")}return null},getFrame=function(a){if(!a||"undefined"==typeof a)return null;if("string"==typeof a&&(a=$.trim(a)),getSelType(a)==CONT_TYPE){var b=getContainerWin(a);return isTop(b)?null:getFrameByWin(b)}if(getSelType(a)==CHILD_TYPE){var b=getChildWin(a);return getFrameByWin(b)}if(getSelType(a)==MIX_TYPE){var c=a.page,d=a.iframe;c||(c="self");var b=getWinOld(c,d);return getFrameByWin(b)}},setSrc=function(a,b){var c=getFrame(a);c&&(c.src=b)},getWin=function(a){if(!a)return null;if("undefined"==typeof a)return window;if("string"==typeof a&&(a=$.trim(a)),getSelType(a)==CONT_TYPE){var b=getContainerWin(a);if(!b)throw'can not find iframe window: "'+a+'"';return b}if(getSelType(a)==CHILD_TYPE){var b=getChildWin(a);if(!b)throw'can not find iframe window: "'+a+'"';return b}if(getSelType(a)==MIX_TYPE){var c=a.page,d=a.iframe;c||(c="self");var b=getWinOld(c,d);if(!b)throw'can not find iframe window at page:"'+c+'", iframe:"'+d+'"';return b}},CONT_TYPE="CON",CHILD_TYPE="CHILD",MIX_TYPE="MIX",conKeys=[];conKeys.top=!0,conKeys.parent=!0,conKeys.self=!0,conKeys["//"]=!0,conKeys["./"]=!0;var getSelType=function(a){return"object"==typeof a?MIX_TYPE:conKeys[a]?CONT_TYPE:a&&a.indexOf("parent")>=0?CONT_TYPE:a&&a.indexOf("./")>=0?CONT_TYPE:a&&a.indexOf("->")>=0?CHILD_TYPE:CHILD_TYPE},foreachFrame=function(a){for(var b=document.getElementsByTagName("iframe"),c=0,d=b.length;d>c;c++)try{a(b[c])}catch(e){}},run=function(a){var b=arguments,c=getWin(a);return c.jQuery[NAMESPACE].runFn(a,b)},runFn=function(a,b){return a.pluginQuery?runAsPlugin(a,b):runAsEval(a,b)},runAsPlugin=function(sel,args){var query=sel.pluginQuery,role=sel.pluginRole,fname=sel.pluginFnName,argstr="";if(args.length>1)for(i=1,len=args.length;len>i;i++)argstr=argstr+", args["+i+"]";var str='$("'+query+'").'+role+'("'+fname+'"'+argstr+");";return eval("var result = "+str),result},runAsEval=function(sel,args){var sel=args[0],fname=args[1],fargs=[];if(args.length>2)for(i=2,len=args.length;len>i;i++)fargs[fargs.length]=args[i];try{var result;return eval("result = window."+fname+".apply(this, fargs);"),result}catch(e){try{eval(fname)}catch(e){var err='error when running: "'+window.location.href+'" '+fname+"();";throw err}}},getChildWin=function(a){var b="->",c=a.split(b);if(0!=c.length){var d=c[0];d=$.trim(d);var e=$(window.document.body).find(d).get(0);if(e){if(c.length>1){var f=a.indexOf(b),g=a.substring(f+b.length);g=$.trim(g);var h=e.contentWindow;return h.jQuery[NAMESPACE].getChildWin(g)}return e?e.contentWindow:null}}},isLoaded=function(){},getContainerWin=function(a){if(a){if(a=$.trim(a),"./"==a||"self"==a)return window;if("//"==a||"top"==a)return top;if("parent"==a)return parent;var b=a.split("../");if(0!=b.length){for(var c=window,d=b.length-1;d>0;)if(isTop(c)){if(d>=1)return}else c=c.parent,d--;return c}}},ePool=[],bindEvent=function(a,b){var c=ePool[a];c||(c=[]),c[c.length]=b,ePool[a]=c},fireEvent=function(a){var b=ePool[a];if(b&&b.length>0)for(var c=0,d=b.length;d>c;c++){var e=b[c];e()}},cleanEvent=function(a){ePool[a]=[]},broadcast=function(a,b){var c,d;"undefined"!=typeof b?(c=a,d=b):(c="top",d=a);var e=getWin(c);e&&e.jQuery[NAMESPACE].broadcastImpl(d)},broadcastImpl=function(a){fireEvent(a),foreachFrame(function(b){if(hasCross(b)){var c=b.contentWindow;c.jQuery[NAMESPACE].broadcastImpl(a)}})},isTop=function(a){return"undefined"==typeof a&&(a=window),top.location==a.location},hasCross=function(a){return a.contentWindow.jQuery&&a.contentWindow.jQuery[NAMESPACE]?!0:!1};me.getFrame=getFrame,me.getWin=getWin,me.getChildWin=getChildWin,me.foreachFrame=foreachFrame,me.getDepth=getDepth,me.broadcast=broadcast,me.broadcastImpl=broadcastImpl,me.run=run,me.runFn=runFn,me.bindEvent=bindEvent,me.fireEvent=fireEvent,me.cleanEvent=cleanEvent,me.getFrameByKey=getFrameByKey,me.getKey=getKey,me.setSrc=setSrc}(jQuery);