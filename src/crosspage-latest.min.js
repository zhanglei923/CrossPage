/* 
 * CrossPage 0.1
 * https://github.com/zhanglei923/CrossPage/
 * Date: 2013-09-23 
 * 
 * Copyright (c) 2013 ZhangLei
 * 
 * Author: ZhangLei
 * Homepage: https://github.com/zhanglei923 
 * Email: zhang.lei.923@gmail.com 
 * 
 * Under the term of the MIT License
 * http://www.opensource.org/licenses/mit-license.php
*/!function($){var NAMESPACE="crosspage",KEY=""+Math.random(),me=$[NAMESPACE]={},getDepth=function(){if(isTop())return 0;for(var a=1,b=parent;top.location!=b.location;)b=b.parent,a++;return a},getWinOld=function(a,b){var c=getContainerWin(a);if("undefined"==typeof b||!b)return c;if(c&&c.jQuery[NAMESPACE]){var d=c.jQuery[NAMESPACE].getChildWin(b);return d}},getKey=function(){return KEY};me.getKey=getKey;var getFrameByKey=function(a){var b;return foreachFrame(function(c){var d=c.contentWindow.jQuery;d&&d[NAMESPACE].getKey()==a&&(b=c)}),b};me.getFrameByKey=getFrameByKey;var getFrameByWin=function(a){try{if(a&&a.parent&&a.parent.jQuery){var b=a.parent.jQuery[NAMESPACE].getFrameByKey(a.jQuery[NAMESPACE].getKey());return b}}catch(c){throw new Error("getFrameByWin(): cross domain")}return null},getFrame=function(a){if(!a||"undefined"==typeof a)return null;if("string"==typeof a&&(a=$.trim(a)),getSelType(a)==CONT_TYPE){var b=getContainerWin(a);return isTop(b)?null:getFrameByWin(b)}if(getSelType(a)==CHILD_TYPE){var b=getChildWin(a);return getFrameByWin(b)}if(getSelType(a)==MIX_TYPE){var c=a.from,d=a.page;c||(c="self");var b=getWinOld(c,d);return getFrameByWin(b)}},getWin=function(a){if(!a)return null;if("undefined"==typeof a)return window;if("string"==typeof a&&(a=$.trim(a)),getSelType(a)==CONT_TYPE)return getContainerWin(a);if(getSelType(a)==CHILD_TYPE)return getChildWin(a);if(getSelType(a)==MIX_TYPE){var b=a.from,c=a.page;return b||(b="self"),getWinOld(b,c)}},CONT_TYPE="CON",CHILD_TYPE="CHILD",MIX_TYPE="MIX",conKeys=[];conKeys.top=!0,conKeys.parent=!0,conKeys.self=!0,conKeys["//"]=!0,conKeys["./"]=!0;var getSelType=function(a){return"object"==typeof a?MIX_TYPE:conKeys[a]?CONT_TYPE:a&&a.indexOf("parent")>=0?CONT_TYPE:a&&a.indexOf("./")>=0?CONT_TYPE:a&&a.indexOf("->")>=0?CHILD_TYPE:CHILD_TYPE},foreachFrame=function(a){for(var b=document.getElementsByTagName("iframe"),c=0,d=b.length;d>c;c++)try{a(b[c])}catch(e){throw new Error("foreachFrame(): cross domain")}},run=function(a,b){var c=arguments,a=c[0],b=c[1],d=[];if(c.length>2)for(i=2,len=c.length;len>i;i++)d[d.length]=c[i];var e=getWin(a);e.jQuery[NAMESPACE].runFn(b,d)},runFn=function(fname,args){eval("window."+fname+".apply(this, args);")};me.runFn=runFn;var getChildWin=function(a){var b="->",c=a.split(b);if(0!=c.length){var d=c[0];d=$.trim(d);var e=$(window.document.body).find(d).get(0);if(e){if(c.length>1){var f=a.indexOf(b),g=a.substring(f+b.length);g=$.trim(g);var h=e.contentWindow;return h.jQuery[NAMESPACE].getChildWin(g)}return e?e.contentWindow:null}}},isLoaded=function(){},getContainerWin=function(a){if(a){if(a=$.trim(a),"./"==a||"self"==a)return window;if("//"==a||"top"==a)return top;if("parent"==a)return parent;var b=a.split("../");if(0!=b.length){for(var c=window,d=b.length-1;d>0;)if(isTop(c)){if(d>=1)return}else c=c.parent,d--;return c}}},ePool=[],bindEvent=function(a,b){var c=ePool[a];c||(c=[]),c[c.length]=b,ePool[a]=c},fireEvent=function(a){var b=ePool[a];if(b&&b.length>0)for(var c=0,d=b.length;d>c;c++){var e=b[c];e()}},cleanEvent=function(a){ePool[a]=[]},broadcast=function(a,b){var c,d;"undefined"!=typeof b?(c=a,d=b):(c="top",d=a);var e=getWin(c);e&&e.jQuery[NAMESPACE].broadcastImpl(d)},broadcastImpl=function(a){fireEvent(a),foreachFrame(function(b){if(hasCross(b)){var c=b.contentWindow;c.jQuery[NAMESPACE].broadcastImpl(a)}})};me.broadcastImpl=broadcastImpl;var isTop=function(a){return"undefined"==typeof a&&(a=window),top.location==a.location},hasCross=function(a){return a.contentWindow.jQuery&&a.contentWindow.jQuery[NAMESPACE]?!0:!1};me.getFrame=getFrame,me.getWin=getWin,me.getChildWin=getChildWin,me.foreachFrame=foreachFrame,me.getDepth=getDepth,me.broadcast=broadcast,me.run=run,me.bindEvent=bindEvent,me.fireEvent=fireEvent,me.cleanEvent=cleanEvent}(jQuery);